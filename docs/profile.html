<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>My Profile - Enri'Le</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Custom CSS -->
  <link rel="stylesheet" href="style.css">
</head>
<body>

<!-- User Welcome Bar -->
<div class="user-welcome" id="userWelcome">
  <div class="container">
    Welcome back, <span id="welcomeUsername"></span>! 
    <a href="#" id="logoutLink" style="color: #5a3e36; margin-left: 15px; text-decoration: underline;">Logout</a>
  </div>
</div>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg sticky-top">
  <div class="container">
    <!-- Logo + Brand -->
    <a class="navbar-brand fw-bold d-flex align-items-center" href="index.html">
      <img src="" alt="" 
           style="height: 45px; width: auto; margin-right: 10px; border-radius: 8px;">
      Enri'Le
    </a>
    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>
    
    <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
      <ul class="navbar-nav">
        <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
        <li class="nav-item"><a class="nav-link" href="shop.html">Shop</a></li>
        <li class="nav-item"><a class="nav-link" href="login.html" id="navLogin">Login</a></li>
        <li class="nav-item d-none" id="profileItem"><a class="nav-link active" href="profile.html">My Profile</a></li>
        <li class="nav-item"><a class="nav-link" href="about.html">About</a></li>
        <li class="nav-item"><a class="nav-link" href="privacy.html">Privacy</a></li>
      </ul>
    </div>
  </div>
</nav>

<!-- Page Hero -->
<section class="page-hero">
  <div class="container">
    <h1>My Profile</h1>
    <p>Manage your account, view orders, and update your preferences.</p>
  </div>
</section>

<!-- Profile Section -->
<section class="profile-section">
  <div class="container">
    <div class="row">
      <!-- Profile Info Column -->
      <div class="col-lg-4 mb-4">
        <div class="profile-card fade-in">
          <div class="profile-header">
            <div class="profile-avatar">
              <i class="fas fa-user"></i>
            </div>
            <h2 class="profile-name" id="profileFullName">Loading...</h2>
            <p class="profile-username" id="profileUsername">@username</p>
          </div>
          <div class="profile-body">
            <h3 class="profile-section-title">Account Information</h3>
            
            <div class="info-item">
              <span class="info-label">Full Name:</span>
              <span class="info-value" id="infoFullName">Loading...</span>
            </div>
            
            <div class="info-item">
              <span class="info-label">Username:</span>
              <span class="info-value" id="infoUsername">Loading...</span>
            </div>
            
            <div class="info-item">
              <span class="info-label">Email:</span>
              <span class="info-value" id="infoEmail">Loading...</span>
            </div>
            
            <div class="info-item">
              <span class="info-label">Member Since:</span>
              <span class="info-value" id="infoMemberSince">Loading...</span>
            </div>
            
            <div class="d-grid mt-4">
              <button class="btn edit-btn" data-bs-toggle="modal" data-bs-target="#editProfileModal">
                <i class="fas fa-edit me-2"></i>Edit Profile
              </button>
            </div>
          </div>
        </div>
        
        <div class="profile-card fade-in">
          <div class="profile-body">
            <h3 class="profile-section-title">Preferences</h3>
            
            <div class="info-item">
              <span class="info-label">Newsletter:</span>
              <span class="info-value">
                <div class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" id="newsletterToggle" checked>
                  <label class="form-check-label" for="newsletterToggle">Subscribed</label>
                </div>
              </span>
            </div>
            
            <div class="info-item">
              <span class="info-label">Style Preferences:</span>
              <span class="info-value">Vintage, Classic</span>
            </div>
            
            <div class="d-grid mt-4">
              <button class="btn edit-btn">
                <i class="fas fa-cog me-2"></i>Manage Preferences
              </button>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Content Column -->
      <div class="col-lg-8">
        <!-- Order History -->
        <div class="profile-card fade-in mb-4">
          <div class="profile-body">
            <h3 class="profile-section-title">Order History</h3>
            
            <div class="order-card">
              <div class="order-header">
                <div>
                  <span class="order-id">Order #VL-2847</span>
                  <span class="order-status status-delivered ms-2">Delivered</span>
                </div>
                <span class="order-date">March 12, 2023</span>
              </div>
              
              <div class="order-items">
                <div class="order-item">
                  <img src="https://ae01.alicdn.com/kf/S23ce2ca642dc4e8cabe3e9f5d15765a1p.jpg_640x640q90.jpg" class="item-image" alt="Floral Dress">
                  <div class="item-details">
                    <div class="item-name">Vintage Floral Dress</div>
                    <div class="item-price">$65.00</div>
                  </div>
                </div>
                
                <div class="order-item">
                  <img src="https://images.unsplash.com/photo-1523170335258-f5ed11844a49?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=880&q=80" class="item-image" alt="Vintage Watch">
                  <div class="item-details">
                    <div class="item-name">Vintage Watch</div>
                    <div class="item-price">$89.00</div>
                  </div>
                </div>
              </div>
              
              <div class="order-total">Total: $154.00</div>
            </div>
            
            <div class="order-card">
              <div class="order-header">
                <div>
                  <span class="order-id">Order #VL-2743</span>
                  <span class="order-status status-shipped ms-2">Shipped</span>
                </div>
                <span class="order-date">February 28, 2023</span>
              </div>
              
              <div class="order-items">
                <div class="order-item">
                  <img src="https://i.etsystatic.com/27071082/r/il/bec26e/3974441708/il_fullxfull.3974441708_s332.jpg" class="item-image" alt="Stussy Jacket">
                  <div class="item-details">
                    <div class="item-name">Stussy Vintage Jacket</div>
                    <div class="item-price">$70.00</div>
                  </div>
                </div>
              </div>
              
              <div class="order-total">Total: $70.00</div>
            </div>
            
            <div class="text-center mt-4">
              <button class="btn edit-btn">
                <i class="fas fa-history me-2"></i>View All Orders
              </button>
            </div>
          </div>
        </div>
        
        <!-- Wishlist -->
        <div class="profile-card fade-in">
          <div class="profile-body">
            <h3 class="profile-section-title">My Wishlist</h3>
            
            <div class="wishlist-item">
              <img src="https://th.bing.com/th/id/OIP.-ThdQECcR3aeyZnTya1WNwHaFT?w=206&h=150&c=6&o=7&dpr=1.3&pid=1.7&rm=3" class="wishlist-image" alt="Gold Ring">
              <div class="wishlist-details">
                <div class="wishlist-name">Vintage Gold Ring</div>
                <div class="wishlist-price">$35.00</div>
                <div class="wishlist-actions">
                  <button class="btn btn-sm edit-btn">
                    <i class="fas fa-shopping-cart me-1"></i>Add to Cart
                  </button>
                  <button class="btn btn-sm btn-secondary">
                    <i class="fas fa-trash me-1"></i>Remove
                  </button>
                </div>
              </div>
            </div>
            
            <div class="wishlist-item">
              <img src="https://th.bing.com/th/id/OIP.abc123example.jpg" class="wishlist-image" alt="Kangol Beret">
              <div class="wishlist-details">
                <div class="wishlist-name">Kangol Beret Hat</div>
                <div class="wishlist-price">$20.00</div>
                <div class="wishlist-actions">
                  <button class="btn btn-sm edit-btn">
                    <i class="fas fa-shopping-cart me-1"></i>Add to Cart
                  </button>
                  <button class="btn btn-sm btn-secondary">
                    <i class="fas fa-trash me-1"></i>Remove
                  </button>
                </div>
              </div>
            </div>
            
            <div class="text-center mt-4">
              <button class="btn edit-btn">
                <i class="fas fa-heart me-2"></i>View Full Wishlist
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Edit Profile Modal -->
<div class="modal fade" id="editProfileModal" tabindex="-1" aria-labelledby="editProfileModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header" style="background-color: var(--accent-brown); color: white;">
        <h5 class="modal-title" id="editProfileModalLabel">Edit Profile</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="editProfileForm">
          <div class="mb-3">
            <label for="editFullName" class="form-label">Full Name</label>
            <input type="text" class="form-control" id="editFullName" required>
          </div>
          <div class="mb-3">
            <label for="editEmail" class="form-label">Email Address</label>
            <input type="email" class="form-control" id="editEmail" required>
          </div>
          <div class="mb-3">
            <label for="editUsername" class="form-label">Username</label>
            <input type="text" class="form-control" id="editUsername" required>
          </div>
          <div class="mb-3">
            <label for="editPassword" class="form-label">New Password (leave blank to keep current)</label>
            <input type="password" class="form-control" id="editPassword">
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn edit-btn" id="saveProfileChanges">Save Changes</button>
      </div>
    </div>
  </div>
</div>

<!-- Footer -->
<footer class="text-center">
  <div class="container">
    <p class="mb-1">&copy; 2025 Enri'Le. All rights reserved.</p>
    <p>Curating timeless pieces for the modern vintage enthusiast.</p>
    <div class="social-icons">
      <a href="#"><i class="fab fa-instagram"></i></a>
      <a href="#"><i class="fab fa-pinterest"></i></a>
      <a href="#"><i class="fab fa-tiktok"></i></a>
    </div>
  </div>
</footer>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- PROFILE FUNCTIONALITY - SIMPLIFIED AND FIXED -->
<script>
// Profile functionality directly in HTML
document.addEventListener('DOMContentLoaded', function() {
    console.log('üöÄ Profile page loaded');
    
    // Check if user is logged in
    const isLoggedIn = localStorage.getItem('isLoggedIn');
    const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
    
    console.log('Login Status:', isLoggedIn);
    console.log('Current User:', currentUser);
    
    // Redirect to login if not logged in
    if (!isLoggedIn || isLoggedIn !== 'true' || !currentUser) {
        console.log('‚ùå Not logged in, redirecting to login...');
        window.location.href = 'login.html';
        return;
    }
    
    console.log('‚úÖ User is logged in:', currentUser.username);
    
    // Populate profile data
    function populateProfileData(user) {
        console.log('üìù Populating profile data for:', user);
        
        // Update profile display
        document.getElementById('profileFullName').textContent = user.fullName || 'User';
        document.getElementById('profileUsername').textContent = `@${user.username}`;
        document.getElementById('infoFullName').textContent = user.fullName || 'Not set';
        document.getElementById('infoUsername').textContent = user.username || 'Not set';
        document.getElementById('infoEmail').textContent = user.email || 'Not set';
        document.getElementById('infoMemberSince').textContent = user.createdAt ? 
            new Date(user.createdAt).toLocaleDateString() : 'Recently';
        
        // Populate edit form
        document.getElementById('editFullName').value = user.fullName || '';
        document.getElementById('editEmail').value = user.email || '';
        document.getElementById('editUsername').value = user.username || '';
        
        console.log('‚úÖ Profile data populated successfully');
    }
    
    // Show logged in state
    function showLoggedInState(user) {
        // Show welcome bar
        const userWelcome = document.getElementById('userWelcome');
        const welcomeUsername = document.getElementById('welcomeUsername');
        
        if (userWelcome) userWelcome.style.display = 'block';
        if (welcomeUsername) welcomeUsername.textContent = user.username;
        
        // Update navigation
        const navLogin = document.getElementById('navLogin');
        const profileItem = document.getElementById('profileItem');
        
        if (navLogin) navLogin.classList.add('d-none');
        if (profileItem) profileItem.classList.remove('d-none');
    }
    
    // Edit profile functionality - SIMPLIFIED AND FIXED
    function setupEditProfile() {
        const saveBtn = document.getElementById('saveProfileChanges');
        
        console.log('üõ† Setting up edit profile functionality...');
        
        if (!saveBtn) {
            console.error('‚ùå Save button not found!');
            return;
        }
        
        saveBtn.addEventListener('click', function() {
            console.log('üíæ SAVE PROFILE BUTTON CLICKED!');
            
            // Get current user data
            const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
            const currentUsername = currentUser.username;
            
            if (!currentUsername) {
                alert('No user logged in!');
                return;
            }
            
            // Get form values
            const newFullName = document.getElementById('editFullName').value.trim();
            const newEmail = document.getElementById('editEmail').value.trim();
            const newUsername = document.getElementById('editUsername').value.trim();
            const newPassword = document.getElementById('editPassword').value;
            
            console.log('Form values:', { newFullName, newEmail, newUsername, newPassword });
            
            // Basic validation
            if (!newFullName || !newEmail || !newUsername) {
                alert('Please fill in all required fields.');
                return;
            }
            
            // Get users database
            const users = JSON.parse(localStorage.getItem('users') || '{}');
            console.log('Current users in database:', Object.keys(users));
            
            // Check if user exists in database
            if (!users[currentUsername]) {
                alert('User not found in database!');
                return;
            }
            
            // Check if new username is taken (only if username changed)
            if (newUsername !== currentUsername && users[newUsername]) {
                alert('Username already exists! Please choose a different one.');
                return;
            }
            
            // UPDATE USER DATA
            try {
                // Update the user object
                const updatedUser = {
                    ...users[currentUsername],
                    fullName: newFullName,
                    email: newEmail,
                    username: newUsername
                };
                
                // Update password if provided
                if (newPassword) {
                    updatedUser.password = newPassword;
                }
                
                // Handle username change in users database
                if (newUsername !== currentUsername) {
                    // Remove old username entry
                    delete users[currentUsername];
                }
                
                // Add/update user with new username
                users[newUsername] = updatedUser;
                
                // Save to localStorage
                localStorage.setItem('users', JSON.stringify(users));
                localStorage.setItem('currentUser', JSON.stringify(updatedUser));
                
                console.log('‚úÖ User data saved successfully!');
                console.log('Updated user:', updatedUser);
                
                // Update UI
                populateProfileData(updatedUser);
                showLoggedInState(updatedUser);
                
                // Show success message
                alert('‚úÖ Profile updated successfully!');
                
                // Clear password field
                document.getElementById('editPassword').value = '';
                
                // FIXED: Simple modal close - use Bootstrap's data attributes
                const modalElement = document.getElementById('editProfileModal');
                const closeButton = modalElement.querySelector('[data-bs-dismiss="modal"]');
                if (closeButton) {
                    closeButton.click();
                } else {
                    // Fallback: hide the modal manually
                    modalElement.classList.remove('show');
                    modalElement.style.display = 'none';
                    document.body.classList.remove('modal-open');
                    const backdrop = document.querySelector('.modal-backdrop');
                    if (backdrop) backdrop.remove();
                }
                
                console.log('‚úÖ Modal closed successfully');
                
            } catch (error) {
                console.error('‚ùå Error saving profile:', error);
                alert('Error saving profile: ' + error.message);
            }
        });
    }
    
    // Logout functionality
    function setupLogout() {
        const logoutLink = document.getElementById('logoutLink');
        if (logoutLink) {
            logoutLink.addEventListener('click', function(e) {
                e.preventDefault();
                console.log('üö™ Logging out...');
                localStorage.removeItem('isLoggedIn');
                localStorage.removeItem('currentUser');
                window.location.href = 'index.html';
            });
        }
    }
    
    // Initialize everything
    function init() {
        console.log('üîÑ Initializing profile page...');
        
        // Populate data and show UI
        populateProfileData(currentUser);
        showLoggedInState(currentUser);
        setupEditProfile();
        setupLogout();
        
        console.log('‚úÖ Profile page fully initialized and ready!');
    }
    
    // Start initialization
    init();
});

// Global error handler
window.addEventListener('error', function(e) {
    console.error('üí• Global JavaScript Error:', e.error);
});
</script>

</body>
</html>